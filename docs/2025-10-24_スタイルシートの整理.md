# スタイルシートを整理する

## 問題意識

- 初期はapplication.cssを育てていく素朴なアプローチだった
- 途中でTailwind CSSを導入した
- 2025年10月現在、ふたつの流派が混在していて管理しにくくなっている
- Tailwind CSSに寄せていきたい

## 進め方

### 基本方針

- 一気にぜんぶやろうとすると、問題が生じたときに原因特定が困難になるので、段階的に進めたい
- たとえば `.setting-cards` と `.setting-card` といったコンポーネントまとまりの単位で作業を区切りたい
- 作業ごとにGitのブランチを切り、人間が表示確認して問題なさそうならマージしてProductionに反映させる

### 作業の優先順位

- 影響範囲が小さいタスク(1〜2ファイルの使用)から始める
- 複雑なコンポーネント(多数のファイルで使用されている)は後回しにする

### 作業フロー

1. **ブランチ作成**
   - ブランチ名: `refactor/[component-name]-to-tailwind`
   - 例: `refactor/setting-cards-to-tailwind`

2. **移行前の表示確認**
   - DevTools MCPで当該コンポーネントが表示されるページにアクセス
   - ログイン状態とログアウト状態の両方で確認が必要な場合がある
     - ログイン方法は `AGENTS.md` を参照（`/dev/login?user_id=1`で開発用ログイン）
   - **各サイズでレイアウトデータを取得してJSONファイルに保存**
     - PC (1280x800):
       - `resize_page(width=1280, height=800)`
       - `evaluate_script` でコンポーネントの主要要素の位置・サイズを取得
       - 結果を `tmp/agent-works/layout-checks/{component}-pc-before.json` に保存
     - タブレット (768x800):
       - `resize_page(width=768, height=800)`
       - `evaluate_script` で同様にデータ取得
       - 結果を `tmp/agent-works/layout-checks/{component}-tablet-before.json` に保存
     - スマートフォン (375x667):
       - `resize_page(width=375, height=667)`
       - `evaluate_script` で同様にデータ取得
       - 結果を `tmp/agent-works/layout-checks/{component}-mobile-before.json` に保存
   - **`evaluate_script` の例**:
     ```javascript
     () => {
       const elements = document.querySelectorAll('.target-class');
       return Array.from(elements).map(el => {
         const rect = el.getBoundingClientRect();
         const styles = window.getComputedStyle(el);
         return {
           text: el.textContent.trim().substring(0, 30),
           left: Math.round(rect.left),
           top: Math.round(rect.top),
           width: Math.round(rect.width),
           height: Math.round(rect.height),
           centerX: Math.round(rect.left + rect.width / 2),
           centerY: Math.round(rect.top + rect.height / 2),
           display: styles.display,
           position: styles.position
         };
       });
     }
     ```
   - **表示確認チェックリスト**:
     - [ ] コンポーネントが正しく表示されている
     - [ ] レイアウトが崩れていない
     - [ ] 各デバイスサイズで適切に表示される
     - [ ] レイアウトデータがJSONファイルに保存されている

3. **CSSの移行**
   - **ステップ1: Tailwind CSSクラスの追加**
     - ERBテンプレートにTailwind CSSクラスを追加
     - **ブラウザをリロードして即座に確認**
       - この段階では、Tailwind CSSと元のCSSが両方適用されている状態
       - 表示が大きく変わっていないことを確認
       - 問題があれば、Tailwind CSSのクラスを修正
   - **ステップ2: 元のCSSの削除**
     - `application.css`から該当するCSSを削除
     - **再度ブラウザをリロードして確認**
       - 元のCSSを削除してもTailwind CSSで正しく表示されることを確認
       - 表示が崩れていたら、Tailwind CSSのクラスを見直す
   - **レスポンシブデザインに注意**:
     - Tailwind CSSはモバイルファーストなので、基本スタイルはモバイル用
     - `md:` プレフィックスは768px以上(タブレット・PC)に適用される
     - 元のCSSが `max-width: 768px` でモバイル指定していた場合、Tailwind CSSでは逆転する

4. **移行後の表示確認**
   - DevTools MCPで再度表示確認
   - ログイン・ログアウト状態の両方で確認（必要に応じて）
   - **各サイズでレイアウトデータを取得してJSONファイルに保存**
     - PC (1280x800):
       - `resize_page(width=1280, height=800)`
       - `evaluate_script` でコンポーネントの主要要素の位置・サイズを取得
       - 結果を `tmp/agent-works/layout-checks/{component}-pc-after.json` に保存
     - タブレット (768x800):
       - `resize_page(width=768, height=800)`
       - `evaluate_script` で同様にデータ取得
       - 結果を `tmp/agent-works/layout-checks/{component}-tablet-after.json` に保存
     - スマートフォン (375x667):
       - `resize_page(width=375, height=667)`
       - `evaluate_script` で同様にデータ取得
       - 結果を `tmp/agent-works/layout-checks/{component}-mobile-after.json` に保存
   - **移行前後のJSONファイルを比較**
     - `before.json` と `after.json` の数値を比較
     - 要素の位置・サイズが移行前と同じか、許容範囲内（±1〜2px）であることを確認
     - **比較の例**:
       ```javascript
       // 親要素の中心に子要素がアライン（中央配置）されているか確認
       () => {
         const children = document.querySelectorAll('.child-class');
         return Array.from(children).map(child => {
           const rect = child.getBoundingClientRect();
           const parent = child.closest('.parent-class');
           const parentRect = parent ? parent.getBoundingClientRect() : null;
           return {
             text: child.textContent.trim().substring(0, 20),
             childCenterX: Math.round(rect.left + rect.width / 2),
             parentCenterX: parentRect ? Math.round(parentRect.left + parentRect.width / 2) : null,
             aligned: parentRect ? Math.abs((rect.left + rect.width / 2) - (parentRect.left + parentRect.width / 2)) < 2 : false
           };
         });
       }
       ```
   - **表示確認チェックリスト**:
     - [ ] レイアウトが崩れていない（移行前と同じ）
     - [ ] 余白・マージンが適切（移行前とほぼ同じ、±1〜2px許容）
     - [ ] 要素の位置が移行前とほぼ同じ
     - [ ] 要素のサイズが移行前とほぼ同じ
     - [ ] 中央配置などのアライメントが正しい
     - [ ] PC・タブレット・スマートフォンすべてで数値確認が完了

5. **ステージング（Claudeが実施）**
   - `git add` で変更をステージングに追加
   - ドキュメント更新(このファイルのチェックボックス)も含める
   - ステージング完了後、人間に引き継ぐ

6. **コミット・プッシュ・PR作成（人間が実施）**
   - `git commit` でコミット作成
   - コミットメッセージは簡潔に
   - `git push` でリモートにプッシュ
   - 直近のPR (#528, #529, #530) の形式に合わせてPR作成
   - 人間が表示確認してマージ

### レスポンシブデザインの注意点

- このアプリケーションでは、タブレット(768px)はPCと同じ横並びレイアウトを使用する
- `md:` ブレークポイントでタブレット・PCを一括で扱う
- モバイルのみ異なるレイアウトにする場合は `max-md:` を使用

## コンポーネントごとに作業する

### 優先度高 (ユーザー向けUI)

- [x] 1. 設定カード (`.setting-cards`, `.setting-card`)
- [x] 2. カードグリッド (`.cards`, `.channel-cards`, `.item-cards`)
- [x] 3. カード画像 (`.card-image`, `.channel-card-image`, `.item-card-image`)
- [x] 4. チャンネルプロフィール (`.channel-profile`, `.channel-profile-image`, `.channel-profile-info`)
- [x] 5. チャンネルボタン (`.channel-buttons`, `.channel-control-buttons`)
- [x] 6. 設定リスト・テーブル (`.setting-list`, `.setting-table`)

### 優先度中 (ナビゲーション・インタラクション)
- [x] 7. ハンバーガーメニュー (`.hamburger-menu-*`)
- [x] 8. チャンネル登録フォーム (`.channel-registration-form-*`, `.channel-form`)
- [x] 9. ナビゲーション (`header nav`, `.pc-menu`)
- [x] 10. スマホタブ (`.sp-tab`)

### 優先度中 (コンテンツ表示)

- [ ] 11. チャンネル・アイテムコンポーネント (`.channel-and-items-component-*`)
- [ ] 12. 未読リスト (`.unreads-list`, `.unreads-nav`, `.unreads-channel-group-tab`)
- [ ] 13. 足跡機能 (`.pawprint-*`, `.chase-paw-*`)
- [x] 14. プロフィール (`.profile`, `.profile-image`)
- [x] 15. オーディオプレイヤー (`.audio-player`, `.audio-player-on-the-image`)
- [ ] 16. ページネーション (`.pagination`, `.page`)
- [x] 17. チャンネル検索 (`.channel_search`)

### 優先度低 (About/ランディングページ)

- [x] 18. ヒーローエリア (`.hero-area`, `.hero-area-*`)
- [x] 19. Aboutコンテンツ (`.about-contents`, `.info-contents`)
- [x] 20. 類似チャンネル (`.similar-channels`)
- [x] 21. ガイド (`.guides`, `.guides-item`, `.guides-button`)

### 優先度低 (共通・細かいもの)

- [x] 22. ログインリンク (`.login-link`)
- [x] 23. 改行制御 (`.br-sp`, `.br-pc`)
- [x] 24. PCメニュー表示制御 (`.pc-menu`)
- [x] 25. 検索アイコン (`.material-symbols-outlined-search`)
- [x] 26. カードチャンネル画像 (`.card-channel img`)
- [x] 27. カードメタ情報 (`.card-description`, `.card-channel`, `.card-publish`)
- [x] 28. 未使用スタイル削除 (`.button-to-unpaw`)
- [x] 29. 未使用スタイル削除 (`.nav-setting`)
- [ ] 30. 共通スタイル (`a`, `textarea`等)
