<div class="flex flex-wrap w-[calc(100%-15px)] max-md:w-full mt-[2em] max-md:mt-[1em] pb-5 border-b border-[#aaaaaa]">
  <% if @channel.image_url %>
  <div class="w-[240px] h-[240px] mr-[30px] max-md:mx-auto max-md:mb-5 overflow-hidden">
    <div class="channel-profile-image-container relative w-full h-full flex items-center justify-center bg-center bg-cover bg-no-repeat" style="background-image: url('<%= @channel.image_url %>')">
      <%= image_tag(@channel.image_url, class: "relative z-[2] max-w-full max-h-full object-contain") %>
    </div>
  </div>
  <% end %>

  <div class="w-[calc(100%-270px)] max-md:w-full">
    <h2 class="text-2xl font-bold mt-6 mb-4"><%= @channel.title %></h2>

    <div class="flex flex-wrap my-2 mb-4">
      <%= render(partial: "subscriptions/link", locals: { channel: @channel }) %>
    </div>

    <% if @channel.description %>
      <p><%= @channel.description %></p>
    <% end %>

    <ul class="my-4 channel-links">
      <% if @channel.site_url %>
      <li class="break-all"><span class="material-symbols-outlined">language</span> <%= link_to(@channel.site_url, @channel.site_url, target: "_blank") %></li>
      <% end %>
      <li class="break-all"><span class="material-symbols-outlined">rss_feed</span> <%= link_to(@channel.feed_url, @channel.feed_url, target: "_blank") %></li>
    </ul>

    <% if @channel.applied_filters.present? && @channel.applied_filters.any? %>
      <div class="my-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
        <div class="flex items-center gap-2">
          <span class="material-symbols-outlined text-blue-600" style="font-size: 18px;">build</span>
          <div class="flex-1">
            <span class="text-sm text-blue-800">
              Applied Filters:
              <% @channel.applied_filters.each_with_index do |filter_name, index| %>
                <span class="font-medium"><%= filter_name %></span><%= index < @channel.applied_filters.length - 1 ? ", " : "" %>
              <% end %>
            </span>
          </div>
        </div>
      </div>
    <% end %>

    <div class="my-4 text-sm text-gray-600">
      <% if @channel.last_items_checked_at %>
        <div class="flex items-center gap-2 mb-2">
          <span class="material-symbols-outlined" style="font-size: 18px;">schedule</span>
          <span>Last checked: <%= @channel.last_items_checked_at.in_time_zone("Asia/Tokyo").strftime("%Y-%m-%d %H:%M JST") %></span>
        </div>
      <% end %>

      <% if @fixed_schedules.any? %>
        <div class="flex items-start gap-2">
          <span class="material-symbols-outlined" style="font-size: 18px;">event_repeat</span>
          <div>
            <span>Update schedule: </span>
            <% @fixed_schedules.each_with_index do |schedule, index| %>
              <span><%= %w[Sun Mon Tue Wed Thu Fri Sat][schedule.day_of_week] %> <%= sprintf("%02d:00", schedule.hour) %></span><%= index < @fixed_schedules.length - 1 ? ", " : "" %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="flex flex-wrap my-2">
      <%= render(partial: "ownerships/link", locals: { channel: @channel }) %>
      <%= link_to(channel_fetch_path(@channel), data: { turbo_method: :post }, class: "flex items-center mr-2 mb-2 px-2 py-1 bg-white text-[#333333] border border-[#cccccc] rounded cursor-pointer text-[90%] hover:bg-[#fafafa] hover:border-[#999999]") do %>
        <span class="material-symbols-outlined text-[18px]">refresh</span>
        Update and fetch items
      <% end %>
    </div>

    <% if @channel.stopper %>
      <p style="padding: 20px; background-color: #ffdf89; color: #946c00;">
        This channel has stopped updating
      </p>
    <% end %>

    <% if @channel.groups.count > 0 %>
    <ul class="my-4 flex flex-wrap gap-6">
      <% @channel.groups.each do |group| %>
        <li class="flex items-center gap-2">
          <%= link_to(channel_group_path(group), class: "inline-block px-4 py-2 bg-white rounded-md border border-white hover:border hover:border-gray-300") do %>
            <%= group.name %>
          <% end %>

          <% grouping = @channel.channel_groupings.find_by(channel_group_id: group.id) %>
          <%= link_to(channel_grouping_path(grouping), data: { turbo_method: :delete, turbo_confirm: "Remove from this group?" }) do %>
            âœ•
          <% end %>
        </li>
      <% end %>
    </ul>
    <% end %>

    <% if logged_in? %>
      <% if current_user.channel_groups.count > 0 %>
        <%= render(partial: "channel_groupings/form", locals: { channel: @channel, channel_groups: current_user.channel_groups }) %>
      <% end %>
    <% end %>
  </div>
</div>

<h3 class="text-lg font-bold">Items</h3>

<%= paginate(@items) %>
<%= render(partial: "items/cards", locals: { items: @items, with_channel: false }) %>
<%= paginate(@items) %>
