<h1>New arrival items!</h1>

<table cellpadding="0" cellspacing="0" style="margin-bottom: 20px;">
  <tr>
    <td style="vertical-align: middle; padding-right: 10px;">
      <img src="<%= @user.avatar_url(variant: :thumb) %>" alt="@<%= @user.name %>" width="48" height="48" style="border-radius: 50%;">
    </td>
    <td style="vertical-align: middle;">
      <p style="margin: 0;">Hi, @<%= @user.name %>!</p>
    </td>
  </tr>
</table>

<% max_items_per_channel = 5 %>
<% @channel_and_items.each do |channel, items| %>
  <% sorted_items = items.sort_by(&:id).reverse %>
  <% display_items = sorted_items.first(max_items_per_channel) %>
  <% remaining_count = sorted_items.size - display_items.size %>

  <hr style="border: none; border-top: 1px solid #eee; margin: 20px 0;">

  <table cellpadding="0" cellspacing="0" style="margin-bottom: 24px;">
    <tr>
      <td style="vertical-align: middle; padding-right: 8px;">
        <img src="<%= channel.favicon_url %>" alt="" width="16" height="16" style="display: block;">
      </td>
      <td style="vertical-align: middle;">
        <h2 style="margin: 0; font-size: 18px;"><%= link_to channel.title, channel.site_url %></h2>
      </td>
    </tr>
  </table>

  <% display_items.each do |item| %>
    <table cellpadding="0" cellspacing="0" style="margin-bottom: 12px; margin-left: 24px; width: calc(100% - 24px);">
      <tr>
        <% if item.image_url.present? %>
          <td style="vertical-align: top; padding-right: 12px; width: 80px;">
            <a href="<%= item.url %>">
              <img src="<%= item.image_url %>" alt="" width="80" style="border-radius: 4px; display: block;">
            </a>
          </td>
        <% end %>
        <td style="vertical-align: top;">
          <p style="margin: 0 0 4px 0;">
            <strong><%= link_to item.title, item.url %></strong>
          </p>
          <p style="margin: 0; color: #999; font-size: 12px;">
            <%= item.published_at.strftime("%Y-%m-%d %H:%M") %>
          </p>
        </td>
      </tr>
    </table>
  <% end %>

  <% if remaining_count > 0 %>
    <p style="margin: 8px 0 0 24px; color: #666; font-size: 14px;">
      <%= link_to "+ #{remaining_count} more items", channel.site_url %>
    </p>
  <% end %>
<% end %>
