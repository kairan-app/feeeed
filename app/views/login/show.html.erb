<div class="max-w-4xl mx-auto py-8 px-4">
  <h1 class="text-3xl font-bold text-gray-800 mb-8">Login</h1>

  <!-- すでに登録済みの方へ -->
  <section class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">すでに登録済みの方</h2>
    <p class="text-gray-600 mb-4">
      そのままGoogleアカウントでログインしてください。
    </p>

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <div id="g_id_onload"
         data-client_id="<%= Rails.application.credentials.google_auth_app.client_id %>"
         data-callback="handleCredentialResponse"
         data-auto_prompt="false">
    </div>
    <div class="g_id_signin"
         data-type="standard"
         data-size="large"
         data-theme="outline"
         data-text="signin_with"
         data-shape="rectangular"
         data-logo_alignment="left">
    </div>
  </section>

  <!-- rururuを使ってみたい方へ -->
  <section class="bg-white rounded-lg shadow-md p-6">
    <h2 class="text-xl font-semibold mb-4">rururuを使ってみたい方</h2>
    <p class="text-gray-600 mb-4">
      rururuは現在Closed Beta期間中です。
    </p>
    <p class="text-gray-600 mb-4">
      rururuへのアクセスは現在、承認制となっています。<br>
      使ってみたい方は、下のボタンからGoogleアカウントで認証したあと、リクエストを送信してください。
    </p>

    <div class="g_id_signin"
         data-type="standard"
         data-size="large"
         data-theme="outline"
         data-text="signin_with"
         data-shape="rectangular"
         data-logo_alignment="left">
    </div>

    <p class="text-gray-600 mt-4 mb-4">
      準備ができましたら、ご登録いただいたGoogleアカウントのメールアドレスにご連絡いたします。
    </p>

    <hr class="my-6 border-gray-200">

    <div class="text-center">
      <p class="text-gray-600">
        お問い合わせがある場合は、開発チームのjunebokuかsugiweにご連絡ください。
      </p>
    </div>
  </section>
</div>

<script>
  function handleCredentialResponse(response) {
    // fetchを使ったより安全な実装
    const csrfToken = document.querySelector('meta[name="csrf-token"]').content;

    fetch('/google_auth_callback', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': csrfToken
      },
      body: JSON.stringify({
        credential: response.credential
      })
    }).then(response => {
      if (response.redirected) {
        window.location.href = response.url;
      }
    });
  }
</script>
