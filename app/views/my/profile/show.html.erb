<section>
  <h2 class="text-2xl font-bold mt-6 mb-4">My Profile</h2>

  <%= form_tag(my_profile_path, method: :put, multipart: true) do |form| %>
    <div class="max-w-md">
      <div class="mb-6">
        <p class="mb-2 font-medium">Profile Icon</p>
        <div class="flex items-center gap-4">
          <div id="avatar-preview-container">
            <%= user_avatar_tag @user, size: :thumb %>
          </div>
          <div>
            <%= file_field_tag :avatar, accept: "image/jpeg,image/jpg,image/png,image/gif,image/webp", class: "block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100", id: "avatar-input" %>
            <p class="text-xs text-gray-500 mt-2">Accepts JPG, PNG, GIF, WebP up to 5MB</p>
          </div>
        </div>
      </div>

      <div class="mb-6">
        <p class="mb-2 font-medium">Username</p>
        <%= text_field_tag(:name, @user.name, class: "w-full px-3 py-2 border border-gray-300 rounded") %>
      </div>

      <div>
        <%= submit_tag("Update Profile", class: "px-4 py-2 border border-slate-500 rounded-xs bg-slate-100 hover:bg-slate-200 cursor-pointer") %>
      </div>
    </div>
  <% end %>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const avatarInput = document.getElementById('avatar-input');
  const avatarPreviewContainer = document.getElementById('avatar-preview-container');

  avatarInput?.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = avatarPreviewContainer.querySelector('img');
        if (img) {
          img.src = e.target.result;
        }
      };
      reader.readAsDataURL(file);
    }
  });
});
</script>
