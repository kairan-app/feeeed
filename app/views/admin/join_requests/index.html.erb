<div class="max-w-6xl mx-auto py-8 px-4">
  <nav class="text-sm text-gray-500 mb-6">
    <%= link_to "Admin", admin_path, class: "hover:underline" %> / <span class="text-gray-800 font-medium">Join Requests</span>
  </nav>

  <% if @pending_requests.any? %>
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4">承認待ち</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full table-auto">
          <thead>
            <tr class="bg-gray-50">
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Icon</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Comment</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Signed Up User</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Requested at</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @pending_requests.each do |request| %>
              <tr>
                <td class="px-4 py-2 whitespace-nowrap">
                  <%= request.email %>
                </td>
                <td class="px-4 py-2 whitespace-nowrap">
                  <% if request.icon_url.present? %>
                    <%= image_tag request.icon_url, class: "h-8 w-8 rounded-full", alt: "Icon" %>
                  <% else %>
                    <span class="text-gray-400">No icon</span>
                  <% end %>
                </td>
                <td class="px-4 py-2">
                  <%= request.comment.presence || "-" %>
                </td>
                <td class="px-4 py-2 whitespace-nowrap text-sm">
                  <% if request.user %>
                    <div class="flex items-center space-x-2">
                      <%= image_tag request.user.avatar_url(variant: :small), class: "h-6 w-6 rounded-full", alt: request.user.name %>
                      <span class="text-green-600 font-medium"><%= request.user.name %></span>
                    </div>
                  <% else %>
                    <span class="text-gray-400">Not signed up</span>
                  <% end %>
                </td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">
                  <%= request.created_at.strftime("%Y-%m-%d %H:%M") %>
                </td>
                <td class="px-4 py-2 whitespace-nowrap text-sm">
                  <%= button_to "Approve",
                        admin_join_request_approval_path(id: request.id),
                        method: :post,
                        class: "inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",
                        data: { confirm: "#{request.email}を承認しますか？" } %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% else %>
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-8">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <p class="text-sm text-yellow-700">承認待ちのリクエストはありません。</p>
        </div>
      </div>
    </div>
  <% end %>

  <% if @approved_requests.any? %>
    <div class="bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-semibold mb-4">最近承認されたリクエスト</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full table-auto">
          <thead>
            <tr class="bg-gray-50">
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Icon</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Comment</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Signed Up User</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Approved By</th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Approved At</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <% @approved_requests.each do |request| %>
              <tr>
                <td class="px-4 py-2 whitespace-nowrap">
                  <%= request.email %>
                </td>
                <td class="px-4 py-2 whitespace-nowrap">
                  <% if request.icon_url.present? %>
                    <%= image_tag request.icon_url, class: "h-8 w-8 rounded-full", alt: "Icon" %>
                  <% else %>
                    <span class="text-gray-400">No icon</span>
                  <% end %>
                </td>
                <td class="px-4 py-2">
                  <%= request.comment.presence || "-" %>
                </td>
                <td class="px-4 py-2 whitespace-nowrap text-sm">
                  <% if request.user.present? %>
                    <div class="flex items-center space-x-2">
                      <%= image_tag request.user.avatar_url(variant: :small), class: "h-6 w-6 rounded-full", alt: request.user.name %>
                      <span class="text-green-600 font-medium"><%= request.user.name %></span>
                    </div>
                  <% else %>
                    <span class="text-gray-400">Not signed up</span>
                  <% end %>
                </td>
                <td class="px-4 py-2 whitespace-nowrap text-sm">
                  <%= request.approved_by&.name || "-" %>
                </td>
                <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">
                  <%= request.approved_at&.strftime("%Y-%m-%d %H:%M") || "-" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  <% end %>
</div>
